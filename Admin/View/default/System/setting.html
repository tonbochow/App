<extend name="Public:base" />

<block name="content">

    <div class="tab-content">
        <div role="tabpanel" class="tab-pane active" id="website">
            <form class="form-horizontal" role="form" name="WebsiteForm" ng-controller="WebsiteController" ng-submit="submitWebsite()">
                <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                    <div class="alert alert-danger" role="alert" ng-show="message"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>{{message}}</div>
                    <div class="alert alert-success" role="alert" ng-show="success"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>{{success}}</div>
                </div>

                <div class="form-group" ng-class="{'has-error' : WebsiteForm.name.$invalid && !WebsiteForm.name.$pristine}">
                    <label for="name" class="col-sm-2 control-label">网站名</label>
                    <div class="col-sm-10">
                        <input type="text" name="name" ng-model="website.name"  ng-minlength="3" ng-maxlength="20" required class="form-control" id="name" placeholder="网站名">
                    </div>
                </div>

                <div class="form-group" ng-class="{'has-error' : WebsiteForm.record.$invalid && !WebsiteForm.record.$pristine}">
                    <label for="record" class="col-sm-2 control-label">网站备案</label>
                    <div class="col-sm-10">
                        <input type="text" name="record" ng-model="website.record"  ng-minlength="3" ng-maxlength="60" required class="form-control" id="record" placeholder="网站备案">
                    </div>
                </div>

                <div class="form-group" ng-class="{'has-error' : WebsiteForm.website_email.$invalid && !WebsiteForm.website_email.$pristine}">
                    <label for="website_email" class="col-sm-2 control-label">站长邮箱</label>
                    <div class="col-sm-10">
                        <input type="text" name="website_email" ng-model="website.website_email"  ng-minlength="3" ng-maxlength="60" required class="form-control" id="website_email" placeholder="站长邮箱">
                    </div>
                </div>

                <div class="form-group" ng-class="{'has-error' : WebsiteForm.copyright.$invalid && !WebsiteForm.copyright.$pristine}">
                    <label for="copyright" class="col-sm-2 control-label">版权信息</label>
                    <div class="col-sm-10">
                        <input type="text" name="copyright" ng-model="website.copyright"  ng-minlength="3" ng-maxlength="60" required class="form-control" id="copyright" placeholder="版权信息">
                    </div>
                </div>

                <div class="form-group" ng-class="{'has-error' : WebsiteForm.seo_title.$invalid && !WebsiteForm.seo_title.$pristine}">
                    <label for="seo_title" class="col-sm-2 control-label">SEO标题</label>
                    <div class="col-sm-10">
                        <input type="text" name="seo_title" ng-model="website.seo_title"  ng-minlength="3" ng-maxlength="60" required class="form-control" id="seo_title" placeholder="SEO标题">
                    </div>
                </div>

                <div class="form-group" ng-class="{'has-error' : WebsiteForm.seo_keyword.$invalid && !WebsiteForm.seo_keyword.$pristine}">
                    <label for="seo_keyword" class="col-sm-2 control-label">SEO关键字</label>
                    <div class="col-sm-10">
                        <input type="text" name="seo_keyword" ng-model="website.seo_keyword"  ng-minlength="3" ng-maxlength="120" required class="form-control" id="seo_title" placeholder="SEO关键字">
                    </div>
                </div>

                <div class="form-group" ng-class="{'has-error' : WebsiteForm.seo_description.$invalid && !WebsiteForm.seo_description.$pristine}">
                    <label for="seo_description" class="col-sm-2 control-label">SEO描述</label>
                    <div class="col-sm-10">
                        <input type="text" name="seo_description" ng-model="website.seo_description"  ng-minlength="3" ng-maxlength="255" required class="form-control" id="seo_description" placeholder="SEO描述">
                    </div>
                </div>

                <div class="form-group" ng-class="{'has-error' : WebsiteForm.front_page_num.$invalid && !WebsiteForm.front_page_num.$pristine}">
                    <label for="front_page_num" class="col-sm-2 control-label">前台分页显示数</label>
                    <div class="col-sm-10">
                        <input type="text" name="front_page_num" ng-model="website.front_page_num"  ng-minlength="1" ng-maxlength="5" required class="form-control" id="front_page_num" placeholder="前台分页显示数">
                    </div>
                </div>

                <div class="form-group" ng-class="{'has-error' : WebsiteForm.back_page_num.$invalid && !WebsiteForm.back_page_num.$pristine}">
                    <label for="back_page_num" class="col-sm-2 control-label">后台分页显示数</label>
                    <div class="col-sm-10">
                        <input type="text" name="back_page_num" ng-model="website.back_page_num"  ng-minlength="1" ng-maxlength="5" required class="form-control" id="back_page_num" placeholder="后台台分页显示数">
                    </div>
                </div>

                <div class="form-group" ng-class="{'has-error' : WebsiteForm.background_img.$invalid && WebsiteForm.background_img.$dirty}">
                    <label for="background_img" class="col-sm-2 control-label">网站背景图片:</label>
                    <div class="col-sm-10">
                        <div id="queue"></div>
                        <img id="previmg" src="{$website.background_img}" style="max-width:400px;max-height: 300px;"/>
                        <input id="file_upload" name="background_img" type="file"  multiple="true">
                        <input type="hidden" name="background_img" id="background_img" value="{{website.background_img}}" ng-model="website.background_img" />
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                        <button type="submit" class="btn btn-success" ng-disabled="WebsiteForm.$invalid"><i class="icon-plus-sign"></i> 保存网站信息</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</block>
<block name="header_script">
    <link rel="stylesheet" type="text/css" href="__COMMON__/uploadify/uploadify.css" media="all">
    <script type="text/javascript" src="__COMMON__/uploadify/jquery.uploadify.min.js"></script>
    <script type="text/javascript">
            var WebsiteModule = angular.module("baby", []);
            WebsiteModule.controller("WebsiteController", function ($scope, $http) {
                $scope.website = {$website_json};
                <?php $timestamp = time(); ?>
                $(function() {
                    $('#file_upload').uploadify({
                        'formData'     : {
                            'timestamp' : '<?php echo $timestamp;?>',
                            'token'     : '<?php echo md5('unique_salt' . $timestamp);?>'
                        },
                        'buttonText':'选择图片',
                        'swf'      : '__COMMON__/uploadify/uploadify.swf',
                        'onUploadSuccess' : function(file, data, response) {
                            $('#previmg').attr('src',data);
                            $('#previmg').css('max-width','400px');
                            $('#previmg').css('max-height','300px');
                            $scope.website.background_img = data;
                       },
                       'uploader' : '/Admin/System/upload'
                    });
                });
            
                $scope.config = {$json_config};
                $scope.submitWebsite = function () {
                    $http({
                        method: "POST",
                                url: "/Admin/System/website",
                                data: $.param($scope.website),
                                headers: {'Content-Type': 'application/x-www-form-urlencoded'}
                        }).success(function (data) {
                        if (data.status) {
                            $scope.success = data.success;
                        } else {
                            $scope.message = data.message;
                        }
                    });
                };
            });
            WebsiteModule.controller("ConfigController", function ($scope, $http) {
                $scope.submitConfig = function () {
                $scope.config = {$json_config};
                    $http({
                    method: "POST",
                            url: "/Admin/System/config",
                            data: $.param($scope.config),
                            headers: {'Content-Type': 'application/x-www-form-urlencoded'}
                    }).success(function (data) {
                        if (data.status) {
                            $scope.success = data.success;
                        } else {
                            $scope.message = data.message;
                        }
                    });
                };
            });
    </script>
</block>